#!/bin/bash

# 更新系统并安装 dante-server
sudo apt update
sudo apt install -y dante-server

# 定义起始端口号
base_port=1080

# 定义你的IP地址列表
declare -a ips=("137.220.171.40" "137.220.171.60" "137.220.171.75")

# 循环遍历每个IP并设置 SOCKS5 代理
for ip in "${ips[@]}"
do
    # 为每个 IP 地址创建一个配置文件
    config_file="/etc/danted-$ip.conf"
    cat <<EOF > $config_file
logoutput: /var/log/danted-$ip.log
internal: $ip port = $base_port
external: $ip
socksmethod: none
user.notprivileged: nobody

client pass {
    from: 0.0.0.0/0 to: 0.0.0.0/0
    log: connect disconnect error
}

socks pass {
    from: 0.0.0.0/0 to: 0.0.0.0/0
    log: connect disconnect error
}
EOF

    # 创建一个新的 systemd 服务文件
    service_file="/etc/systemd/system/danted-$ip.service"
    cat <<EOF > $service_file
[Unit]
Description=Dante SOCKS Server for $ip
After=network.target

[Service]
ExecStart=/usr/sbin/danted -f $config_file
Restart=always
User=root

[Install]
WantedBy=multi-user.target
EOF

    # 启动并启用服务
    systemctl enable danted-$ip
    systemctl start danted-$ip

    # 增加端口号以避免冲突
    ((base_port++))
done
